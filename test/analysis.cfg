process analysis = {

  #keep the logging output to a nice level
  include "FWCore/MessageLogger/data/MessageLogger.cfi"

  source = PoolSource {
	 untracked vstring fileNames = {
	 #'/store/mc/2007/7/11/CSA07-QCD_Pt_80_120-2027/0001/0001F088-9832-DC11-A133-000423DCF6B8.root'
	 #'/store/mc/2007/7/17/CSA07-QCD_Pt_50_80-2049/0003/002B6C8B-8D35-DC11-AAAA-001617C3B6A0.root'
	 #'/store/mc/2007/7/11/CSA07-QCD_Pt_80_120-2027/0001/0001F088-9832-DC11-A133-000423DCF6B8.root'
	'/store/CSA07/skims/2007/10/25/CSA07-CSA07AllEvents-Stew-B1-PDAllEvents-Skims0/0000/D2053D90-CC87-DC11-BC0B-001731AF687F.root'
	 }
  }
  
  untracked PSet maxEvents = { untracked int32 input = 10 }

#replace PoolSource.fileNames = {
#'/store/mc/2007/12/5/RelVal-RelValBJets_Pt_50_120-1196896807/0001/1A993615-D8A4-DC11-BC2F-001617C3B6E2.root',
#'/store/mc/2007/12/5/RelVal-RelValBJets_Pt_50_120-1196896807/0001/220E9214-D8A4-DC11-AF1F-001617C3B6DE.root',
#'/store/mc/2007/12/5/RelVal-RelValBJets_Pt_50_120-1196896807/0001/5C879D0F-D8A4-DC11-B513-000423D99EEE.root',
#'/store/mc/2007/12/5/RelVal-RelValBJets_Pt_50_120-1196896807/0001/70F9CA10-D8A4-DC11-A4ED-000423D33970.root',
#'/store/mc/2007/12/5/RelVal-RelValBJets_Pt_50_120-1196896807/0001/7253A804-D8A4-DC11-A90A-001617C3B6FE.root',
#'/store/mc/2007/12/5/RelVal-RelValBJets_Pt_50_120-1196896807/0001/C8421E17-D8A4-DC11-9BF3-000423D99E46.root',
#'/store/mc/2007/12/5/RelVal-RelValBJets_Pt_50_120-1196896807/0001/D21E1C15-D8A4-DC11-B160-001617C3B79A.root',
#'/store/mc/2007/12/5/RelVal-RelValBJets_Pt_50_120-1196896807/0001/D825DD14-D8A4-DC11-9EF4-000423D99660.root',
#'/store/mc/2007/12/5/RelVal-RelValBJets_Pt_50_120-1196896807/0001/F0922506-D8A4-DC11-90CE-000423D6CA02.root',
#'/store/mc/2007/12/5/RelVal-RelValBJets_Pt_50_120-1196896807/0001/F69B120F-D8A4-DC11-9AC0-001617E30D00.root'
#}

replace PoolSource.fileNames = {
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/280930AB-93E5-DC11-BD44-0030487C618C.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/2C8585BC-93E5-DC11-B1BA-0030487A323E.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/3ED0C1DC-C5E5-DC11-A0C3-000423D99F1E.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/4629BF8D-93E5-DC11-902D-0016177CA778.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/48209EEE-A5E5-DC11-991B-000423D9863C.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/543F4BE0-95E5-DC11-8A44-000423D94494.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/5CB70F94-93E5-DC11-87BF-0030487A3232.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/6C56893C-B8E5-DC11-91DC-001617E30F4C.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/74551202-E5E5-DC11-B053-001617DBD5B2.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/A80C8888-DFE5-DC11-B684-000423D9970C.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/B49D75A9-93E5-DC11-9DE4-0030487A323E.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/CA144CD1-EEE5-DC11-A79F-000423D6B444.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/D0E74D7A-93E5-DC11-9E98-0030487C5D02.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/D254FE0D-AEE5-DC11-9DC6-001617E30D38.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/D2663149-ECE5-DC11-AF1B-000423D6A6F4.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/DEE610A0-93E5-DC11-81E5-0030487A3232.root',
'/store/relval/2008/2/27/RelVal-RelValTTbar-1204132718/0000/FE5EAE60-93E5-DC11-AB18-000423D98F98.root'
}


  # rerun track counting to pickup new default
  #include "RecoBTag/TrackCounting/data/trackCounting.cff"
  # include track probability tagger, needed in 13X
  # include "RecoBTag/TrackProbability/data/trackProbability.cff"

  # jet corrections
  include "JetMETCorrections/MCJet/data/MCJetCorrections152.cff"
  es_prefer MCJetCorrectorIcone5 = MCJetCorrectionService {}

	
  include "RecoBTag/PerformanceMeasurements/data/JetPartonAssoc.cff"
  sequence jetPartonAssoc = {caloJetCollectionClone, tagJet}
  include "RecoBTag/PerformanceMeasurements/data/PerformanceAnalyzer.cff"
  #replace Performance.outputFile = "results.root"
  # the following line is needed for RECO samples
  replace Performance.GenJets = "iterativeCone5GenJets"
  # use the next line if you want to use HepMC collection for flavor ID
  replace Performance.flavourMatchOption = "hepMC"

  # TrackClassifier
  include "SimTracker/TrackHistory/data/TrackClassifier.cff"

  ### MODIFIED TRACK COUNTING, removed muons ###
  module modifiedjetTracksAssociator = jetTracksAssociator from "RecoBTau/JetTracksAssociator/data/jetTracksAssociator.cfi"
  replace modifiedjetTracksAssociator.RemoveMuonTrks = true
  module modifiedimpactParameterTagInfos = impactParameterTagInfos from "RecoBTag/ImpactParameter/data/impactParameter.cfi"
  replace modifiedimpactParameterTagInfos.jetTracks = "modifiedjetTracksAssociator"
  module modifiedtrackCountingTagInfos = trackCountingTagInfos from "RecoBTag/TrackCounting/data/trackCounting.cfi"
  module modifiedtrackCountingHighEffJetTags = trackCountingHighEffJetTags from "RecoBTau/JetTagProducer/data/trackCountingHighEffJetTags.cfi"
  replace modifiedtrackCountingHighEffJetTags.tagInfo = "modifiedimpactParameterTagInfos"
  module modifiedtrackCountingHighPurJetTags = trackCountingHighPurJetTags from "RecoBTau/JetTagProducer/data/trackCountingHighPurJetTags.cfi"
  replace modifiedtrackCountingHighPurJetTags.tagInfo = "modifiedimpactParameterTagInfos"
 
  ### CSA07 EVENT WEIGHTS 
  module csaweightproducer = CSA07EventWeightProducer {
    InputTag src = source

    # verbosity
    untracked bool talkToMe = true

    # overall luminosity normalization  (in pb-1)
    double overallLumi = 1000.
  }

  ### NEGATIVE TAGS
  include "RecoBTag/TrackProbability/data/negativeOnlyJetProbabilityComputer.cfi"
  include "RecoBTag/TrackProbability/data/positiveOnlyJetProbabilityComputer.cfi"
  include "RecoBTau/JetTagProducer/data/jetTagRecord.cfi"
  include "RecoBTag/ImpactParameter/data/impactParameter.cff"
  include "RecoBTag/TrackCounting/data/trackCounting3D3rd.cfi"
  include "RecoBTag/TrackCounting/data/trackCounting3D2nd.cfi"

  module jetProbabilityJetTagsNegativeOnly =  JetTagProducerImpactParameter 
     { 
       InputTag tagInfo = impactParameterTagInfos
       string jetTagComputer = "negativeOnlyJetProbability"
      }
  
  module jetProbabilityJetTagsPositiveOnly =  JetTagProducerImpactParameter 
     { 
       InputTag tagInfo = impactParameterTagInfos
       string jetTagComputer = "positiveOnlyJetProbability"
      }



    es_module negativeTrackCounting3D2nd = NegativeTrackCountingESProducer {
	string ComponentName = "negativeTrackCounting3D2nd"
	PSet JetTagComputerPSet = {
	    int32 nthTrack = 2
	    int32 impactParamterType = 0
        }
    }
    
    module negativeTrackCounting2ndTrck =  JetTagProducerImpactParameter
    {
	InputTag tagInfo = impactParameterTagInfos
	string jetTagComputer = "negativeTrackCounting3D2nd"
    }
    
    es_module negativeTrackCounting3D3rd = NegativeTrackCountingESProducer {
	string ComponentName = "negativeTrackCounting3D3rd"
	PSet JetTagComputerPSet = {
	    int32 nthTrack = 3
	    int32 impactParamterType = 0
        }
    }
    
    module negativeTrackCounting3rdTrck =  JetTagProducerImpactParameter
    {
	InputTag tagInfo = impactParameterTagInfos
	string jetTagComputer = "negativeTrackCounting3D3rd"
    }

    
    module out = PoolOutputModule {
      untracked string fileName = "testtt.root"
      untracked vstring outputCommands = { 
	"drop *",
	"keep recoJetTags_*_*_*"

      }
    }

 # rerun JetProbability tagger with new calibrations
 include "RecoBTag/TrackProbability/data/jetProbabilityComputer.cfi"
 include "RecoBTau/JetTagProducer/data/jetProbabilityJetTags.cfi"
 

sequence modifiedbtagging = {modifiedjetTracksAssociator, modifiedimpactParameterTagInfos,modifiedtrackCountingHighEffJetTags,  modifiedtrackCountingHighPurJetTags}

  # running without weights
  path p = {
       MCJetCorJetIcone5,
       jetProbabilityJetTags,
       modifiedbtagging,
       impactParameterTagInfos,
       jetProbabilityJetTagsNegativeOnly,
       jetProbabilityJetTagsPositiveOnly,
       negativeTrackCounting2ndTrck,
       negativeTrackCounting3rdTrck,
       jetPartonAssoc,
       #csaweightproducer,
       Performance
       #OUTPut
  }
	#endpath output = { out }		
}
