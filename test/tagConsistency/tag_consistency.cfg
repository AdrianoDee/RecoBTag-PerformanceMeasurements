process TopBTagEff  = {
	
	# initialize MessageLogger
   	include "FWCore/MessageLogger/data/MessageLogger.cfi"
        replace MessageLogger.cerr.threshold = "WARNING"
        #replace MessageLogger.cerr.threshold = "ERROR"

  	# return trigger report (including filter efficiencies)
  	#untracked PSet options = { untracked bool wantSummary = true }
	  
   	# input
	untracked PSet maxEvents = {untracked int32 input = 100}
	source = PoolSource {
		untracked vstring fileNames =
    		{
                        /CSA07Electron/CMSSW_1_6_7-CSA07-Chowder-A3-PDElectron-ReReco-100pb-Skims8-topSemiLepElectron/USER
			#'/store/mc/2007/8/31/CSA07-tt0j_mT_70-alpgen-2231/0001/0016DF8B-1A6D-DC11-A418-000423D987FC.root'
                        #'/store/mc/2007/8/29/CSA07-tt1j_mT_70-alpgen-2211/0000/08972D6E-6162-DC11-9E3C-003048767ECB.root'
                        #'/store/mc/2007/9/26/CSA07-W3jet_0ptw100-alpgen-2223/0000/020C3771-E06C-DC11-AF67-000423D98F98.root'
			#'/localscratch/s/speer/top_eff/cmssw/test_data/CSA07-tt0j_mT_70-alpgen-2231_0016DF8B-1A6D-DC11-A418-000423D987FC.root'
    		}
         #untracked uint32 skipEvents = 0
	}

  ### MC truth
  // comment the next line, when running over a primary dataset containing already 'GenParticle' instead of 'GenParticleCandidate'
  include "PhysicsTools/HepMCCandAlgos/data/genParticleCandidates2GenParticles.cfi"

  ### TQAF ###

  # TQAF Layer 1 TopObject production
  include "TopQuarkAnalysis/TopObjectProducers/data/TQAFLayer1.cff"

  # Construct the MC Generated Ttbar Event
  include "TopQuarkAnalysis/TopEventProducers/data/TtGenEvtProducer.cff"

  # apply a kinematic selection on the TopObjects
  #include "TopQuarkAnalysis/BTagPerformanceMeasurementFromTop/data/TtSemiObjectSelection.cff"
   include "RecoBTag/PerformanceMeasurements/data/TtSemiObjectSelection.cff"

  # filter events requiring a minimal number of final state TopObjects
  #include "TopQuarkAnalysis/TopEventProducers/data/TtSemiObjectCountFilter.cff"

  # TQAF Layer 2 for the ttbar semi-leptonic final state
  #include "TopQuarkAnalysis/TopEventProducers/data/TQAFLayer2_TtSemi.cff"

#analysis
	module myTtObservables = TtObservables {

              string dataType = "MC"

              string jetSource = "allLayer1TopJets"
              string electronSource = "allLayer1TopElectrons"
              string muonSource = "allLayer1TopMuons"
              string METSource = "allLayer1TopMETs"
              #string jetTagSource = "trackCountingHighEffJetTags"
	      string jetTagSource = "jetProbabilityJetTags"

              #-- MC only
              bool lookForGenJetMatch = false
              double dRGenJetMatch = 0.7
              #string genJetSource = "iterativeCone5GenJets"
              #string genJetSource = "genParticles"

              int32 nCaloJetsLow = 4
              int32 nLeptonLow = 1
              double discriminatorLow = 0.0
              double discriminatorHigh = 15.0
              double discriminatorStep = 0.1
              int32 intermediateResultFrequency = 800000
              string outputFileName = "tag_consistency"
        }

	module myTopBTagAnalysis = TtSemiLeptonicTagCounting {

              string dataType = "MC"

              string jetSource      = "selectedLayer1TopJets"
              string electronSource = "selectedLayer1TopElectrons"
              string muonSource     = "selectedLayer1TopMuons"
              string METSource      = "selectedLayer1TopMETs"

              string jetTagSource   = "trackCountingHighEffJetTags"
              double discriminatorLow = 0.0
              double discriminatorHigh = 10.0
              double discriminatorStep = 0.1

              string jetTagSource_2   = "trackCountingHighPurJetTags"
              double discriminatorLow_2 = 0.0
              double discriminatorHigh_2 = 10.0
              double discriminatorStep_2 = 0.1

              string jetTagSource_3      = "jetProbabilityJetTags"
              double discriminatorLow_3  = 0.0
              double discriminatorHigh_3 = 1.0
              double discriminatorStep_3 = 0.01

              #-- MC only
              bool lookForGenJetMatch = false
              double dRGenJetMatch    = 0.7
              #string genJetSource     = "iterativeCone5GenJets"
              #string genJetSource = "genParticles"

              int32 nCaloJetsLow = 4
              int32 nLeptonLow = 1
              int32 intermediateResultFrequency = 800000
              string outputFileName = "tag_consistency"
	}

		

        # output
  module out = PoolOutputModule {
    untracked string fileName = "TQAFLayer1Output.root"
    #who else?using EventSelection
    untracked vstring outputCommands = {
      "drop *",
      #"keep edmTriggerResults_TriggerResults_*_*",
      #"keep *_genParticleCandidates_*_*",
      "keep *_genParticles_*_*",
      #"keep recoJetTags_*_*_*",
      #"drop recoJetTags_coneIsolationTauJetTags_*_*",
      #"keep recoTracks_ctfWithMaterialTracks_*_*",
      #"keep *_offlinePrimaryVerticesFromCTFTracks_*_*",
      "keep *_selectedLayer1TopElectrons_*_*",
      "keep *_selectedLayer1TopMuons_*_*",
      #"keep *_selectedLayer1TopTaus_*_*",
      "keep *_selectedLayer1TopJets_*_*",
      "keep *_selectedLayer1TopMETs_*_*"
    }
    untracked bool verbose = true
  }

        #path p = {makeGenEvt, ttSemiLeptonicFilter, highLevelReco, allTopObjects, objectSelection, myTopBTagAnalysis }
        #path p = {makeGenEvt, ttSemiLeptonicFilter, highLevelReco, allTopObjects, myTtObservables, objectSelection, myTopBTagAnalysis }
        #path p = {highLevelReco, allTopObjects, myTtObservables, objectSelection, myTopBTagAnalysis }
	#path p = {tqafLayer1, myTtObservables, objectSelection, myTopBTagAnalysis }

        #path p = {tqafHighLevelReco, allTopObjects, myTtObservables, objectSelection, myTopBTagAnalysis }
        path p = {genParticles, tqafHighLevelReco, allTopObjects, myTtObservables, objectSelection, myTopBTagAnalysis }

        endpath outpath = { out }
	
}
