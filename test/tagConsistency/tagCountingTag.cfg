#both FNAL and CERN
#'/store/CSA07/2007/11/21/CSA07-CSA07BJet-Tier0-A1-Chowder/0000/000E411C-3699-DC11-8882-0019DB29C614.root'
#'/store/mc/2007/12/12/CSA07-tt4j_mT_70-alpgen-3700/0004/F4C08731-9BA9-DC11-A37F-0030487A9EA6.root'
#'/store/mc/2007/8/31/CSA07-tt0j_mT_70-alpgen-2231/0001/0016DF8B-1A6D-DC11-A418-000423D987FC.root'
process TopBTagEff  = {
	
	# initialize MessageLogger
   	include "FWCore/MessageLogger/data/MessageLogger.cfi"
        #replace MessageLogger.cerr.threshold = "WARNING"

  	# return trigger report (including filter efficiencies)
  	#untracked PSet options = { untracked bool wantSummary = true }
	  
   	# input
	untracked PSet maxEvents = {untracked int32 input = 100}
	source = PoolSource {
		untracked vstring fileNames =
    		{
                   #'/localscratch/s/speer/top_eff/crab_top_data/ttj0/res/TQAFLayer2Output_3.root'
                   '/localscratch/s/speer/top_eff/cmssw/test_data/CSA07-tt0j_mT_70-alpgen-2231_0016DF8B-1A6D-DC11-A418-000423D987FC.root'
    		}
         #untracked uint32 skipEvents = 0
	}

  ### TQAF ###

  # TQAF Layer 1 TopObject production
  include "TopQuarkAnalysis/TopObjectProducers/data/TQAFLayer1.cff"

  # Construct the MC Generated Ttbar Event
  include "TopQuarkAnalysis/TopEventProducers/data/TtGenEvtProducer.cff"

  # apply a kinematic selection on the TopObjects
  #include "TopQuarkAnalysis/BTagPerformanceMeasurementFromTop/data/TtSemiObjectSelection.cff"
   include "RecoBTag/PerformanceMeasurements/data/TtSemiObjectSelection.cff"

  # filter events requiring a minimal number of final state TopObjects
  #include "TopQuarkAnalysis/TopEventProducers/data/TtSemiObjectCountFilter.cff"

  # TQAF Layer 2 for the ttbar semi-leptonic final state
  #include "TopQuarkAnalysis/TopEventProducers/data/TQAFLayer2_TtSemi.cff"

#analysis
	module myTtObservables = TtObservables {

              string dataType = "MC"

              string jetSource = "allLayer1TopJets"
              string electronSource = "allLayer1TopElectrons"
              string muonSource = "allLayer1TopMuons"
              string METSource = "allLayer1TopMETs"
              #string jetTagSource = "trackCountingJetTags"
	      string jetTagSource = "trackProbabilityJetTags"

              #-- MC only
              bool lookForGenJetMatch = false
              double dRGenJetMatch = 0.7
              string genJetSource = "iterativeCone5GenJets"

              int32 nCaloJetsLow = 4
              int32 nLeptonLow = 1
              double discriminatorLow = 0.0
              double discriminatorHigh = 15.0
              double discriminatorStep = 0.1
              int32 intermediateResultFrequency = 800000
              string outputFileName = "tagCountingTag"
        }

	module myTopBTagAnalysis = TtSemiLeptonicTagCounting {

              string dataType = "MC"

              string jetSource      = "selectedLayer1TopJets"
              string electronSource = "selectedLayer1TopElectrons"
              string muonSource     = "selectedLayer1TopMuons"
              string METSource      = "selectedLayer1TopMETs"

              string jetTagSource   = "trackCountingJetTags"
              double discriminatorLow = 0.0
              double discriminatorHigh = 10.0
              double discriminatorStep = 0.1

              string jetTagSource_2   = "trackCountingJetTags3th"
              double discriminatorLow_2 = 0.0
              double discriminatorHigh_2 = 10.0
              double discriminatorStep_2 = 0.1

              string jetTagSource_3      = "trackProbabilityJetTags"
              double discriminatorLow_3  = 0.0
              double discriminatorHigh_3 = 1.0
              double discriminatorStep_3 = 0.01

              #-- MC only
              bool lookForGenJetMatch = false
              double dRGenJetMatch    = 0.7
              string genJetSource     = "iterativeCone5GenJets"

              int32 nCaloJetsLow = 4
              int32 nLeptonLow = 1
              int32 intermediateResultFrequency = 800000
              string outputFileName = "tagCountingTag"
	}

		

        # output
  module out = PoolOutputModule {
    untracked string fileName = "TQAFLayer1Output.root"
    #who else?using EventSelection
    untracked vstring outputCommands = {
      "drop *",
      "keep edmTriggerResults_TriggerResults_*_*",
      "keep *_genParticleCandidates_*_*",
      "keep recoJetTags_*_*_*",
      "drop recoJetTags_coneIsolationTauJetTags_*_*",
      "keep recoTracks_ctfWithMaterialTracks_*_*",
      "keep *_offlinePrimaryVerticesFromCTFTracks_*_*",
      "keep *_selectedLayer1TopElectrons_*_*",
      "keep *_selectedLayer1TopMuons_*_*",
      "keep *_selectedLayer1TopTaus_*_*",
      "keep *_selectedLayer1TopJets_*_*",
      "keep *_selectedLayer1TopMETs_*_*"
    }
    untracked bool verbose = true
  }

        #path p = {makeGenEvt, ttSemiLeptonicFilter, highLevelReco, allTopObjects, objectSelection, myTopBTagAnalysis }
        #path p = {makeGenEvt, ttSemiLeptonicFilter, highLevelReco, allTopObjects, myTtObservables, objectSelection, myTopBTagAnalysis }
        #path p = {highLevelReco, allTopObjects, myTtObservables, objectSelection, myTopBTagAnalysis }
	#path p = {tqafLayer1, myTtObservables, objectSelection, myTopBTagAnalysis }

        path p = {tqafHighLevelReco, allTopObjects, myTtObservables, objectSelection, myTopBTagAnalysis }

        #endpath outpath = { out }
	
}
